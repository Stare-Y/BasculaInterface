<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:BasculaInterface.ViewModels"
             x:Class="BasculaInterface.Views.WeightingScreen"
             Title="WeightingScreen">

    <ContentPage.BindingContext>
        <vm:BasculaViewModel/>
    </ContentPage.BindingContext>
  
    
    <Grid Padding="20" RowSpacing="20" RowDefinitions="auto,*,auto,auto">
        <Grid Grid.Row="0" ColumnDefinitions="Auto,*,Auto" VerticalOptions="Center" >

            <!-- Estado  -->
            <Label 
                Text="{Binding Estado}" 
                FontAttributes="Bold"
                VerticalTextAlignment="Center"
                Grid.Column="0"/>

            <!-- Nombre socio -->
            <Label
                Grid.Column="1"
                Text="{Binding Partner.RazonSocial}"
                FontAttributes="Bold"
                FontSize="20"
                HorizontalOptions="Center"
                VerticalTextAlignment="Center"
                />
            
            <!-- BotÃ³n reconectar -->
            <Button 
                Grid.Column="2"
                Text="Reconectar" 
                x:Name="BtnReconect"
                Clicked="BtnReconect_Clicked"
                BackgroundColor="{StaticResource 1}"
                TextColor="{StaticResource 4}"
                CornerRadius="8"
                Padding="12,6"
                HorizontalOptions="End"
                BorderColor="{StaticResource 4}"
                BorderWidth="2"/>
        </Grid>
       
        <!-- Incia separador -->
        <BoxView
            Grid.Row="1"
            HeightRequest="2"
            HorizontalOptions="Fill"
            VerticalOptions="Start"
            Color="{StaticResource 4}" />
        <!-- Termina separador -->

        <!--<Grid RowSpacing="20" ColumnSpacing="20" Grid.Row="1">
            
            --><!-- Definimos filas y columnas --><!--
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                --><!-- Encabezado (producto, placas, notas) --><!--
                <RowDefinition Height="*"/>
                --><!-- Peso --><!--
                <RowDefinition Height="Auto"/>
                --><!-- Tara / Diferencia --><!--
                <RowDefinition Height="Auto"/>
                --><!-- Botones inferiores --><!--
            </Grid.RowDefinitions>

            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <Grid Grid.Row="0" Grid.ColumnSpan="2" ColumnDefinitions="*,*" ColumnSpacing="20">
                <Grid Grid.Column="0">
                    <Label 
                Text="{Binding Product.Nombre, StringFormat='Producto: {0}'}" 
                VerticalTextAlignment="Center"
                FontAttributes="Bold"
                TextColor="#0B1437"
                FontSize="16"/>
                </Grid>

                --><!--<Grid Grid.Column="1" ColumnDefinitions="*,*" ColumnSpacing="20" RowDefinitions="*,*">
                    <Label Text="Placas: " HorizontalTextAlignment="End" VerticalTextAlignment="Center" Grid.Row="0" Grid.Column="0"/>
                    <Entry Text="{Binding WeightEntry.VehiclePlate}" x:Name="EntryVehiclePlate" Grid.Row="0" Grid.Column="1"/>
                    <Label Text="Notas: " HorizontalTextAlignment="End" VerticalTextAlignment="Center" Grid.Row="1" Grid.Column="0"/>
                    <Entry Text="{Binding WeightEntry.Notes}" Grid.Row="1" Grid.Column="1"/>
                </Grid>-->
                <!--<Grid Grid.Column="1" ColumnDefinitions="Auto,*" RowDefinitions="Auto,Auto" ColumnSpacing="10">
                    <Label Text="Placas:" Grid.Row="0" Grid.Column="0" VerticalTextAlignment="Center" TextColor="Black"/>
                    <Entry Text="{Binding WeightEntry.VehiclePlate}" Grid.Row="0" Grid.Column="1"  x:Name="EntryVehiclePlate" />
                    <Label Text="Notas:" Grid.Row="1" Grid.Column="0" VerticalTextAlignment="Center" TextColor="Black"/>
                    <Entry Text="{Binding WeightEntry.Notes}" Grid.Row="1" Grid.Column="1" />
                </Grid>--><!--
            </Grid>
        </Grid>-->
        
        <Grid Grid.Row="1"
             ColumnSpacing="20" Padding="5" >
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <!-- 3 Filas -->
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <!-- Placas / Notas -->
                <RowDefinition Height="*"/>
                <!-- Peso -->
                <RowDefinition Height="Auto"/>
                <!-- Tara / Diferencia -->
            </Grid.RowDefinitions>


            <Border
                 Grid.Row="0" Grid.Column="2" 
                 Stroke="{StaticResource 4}"         
                 StrokeThickness="2"
                 StrokeShape="RoundRectangle 10"
                 Padding="5"
                 BackgroundColor="{StaticResource Gray}" 
                 HeightRequest="100"
                 VerticalOptions="Start"
                >
                <StackLayout  Orientation="Vertical" >
                    <Label Text="Placas:" 
                           FontAttributes="Bold"
                           TextColor="{StaticResource 4}" 
                           Margin="0,10"/>
                    <Entry Text="{Binding WeightEntry.VehiclePlate}" 
                           x:Name="EntryVehiclePlate"
                           Placeholder="Ingresa placas"/>
                </StackLayout>
            </Border>
            
            
            <StackLayout Grid.Row="0" Grid.Column="1" Orientation="Vertical" HorizontalOptions="Start">
                <Label 
                Text="{Binding Product.Nombre, StringFormat='Producto: {0}'}" 
                VerticalTextAlignment="Center"
                FontAttributes="Bold"
                TextColor="#0B1437"
                FontSize="16"/>
            </StackLayout>
            
            <!-- NOTAS (arriba derecha) -->
            <Border
                Grid.Row="0" 
                Grid.Column="0" 
                Stroke="{StaticResource 4}"         
                StrokeThickness="2"
                StrokeShape="RoundRectangle 10"
                Padding="5"
                BackgroundColor="{StaticResource Gray}">
                  
                    <StackLayout 
                    Orientation="Vertical">
                        <Label 
                        Text="Notas:"
                        FontAttributes="Bold"
                        TextColor="{StaticResource 4}"  
                        Margin="0,10"/>
                        <Editor
                        Placeholder="Escribe tus notas..."
                        AutoSize="TextChanges"
                        Text="{Binding WeightEntry.Notes}"
                        HeightRequest="90"
                        BackgroundColor="White"
                        TextColor="Black"
                        FontSize="16" />

                        <!--<Entry Text="{Binding WeightEntry.Notes}" 
                         Placeholder="Escribe notas..."/>-->
                    </StackLayout>

            </Border>

            <Border
                Grid.Row="1" Grid.Column="1"
                HeightRequest="350"
                WidthRequest="350"
                Stroke="{StaticResource 4}"         
                StrokeThickness="3"
                StrokeShape="RoundRectangle 175"
              
                BackgroundColor="White"
                HorizontalOptions="Center"
                VerticalOptions="Center"
                Padding="20"
                >

                <!-- Contenido (texto del peso) -->
                <Label 
                    x:Name="PesoLabel"
                    Text="{Binding Peso, StringFormat='{0:0.00} kg'}"
                    FontSize="48"
                    FontAttributes="Bold"
                    TextColor="#304FFE"
                    HorizontalTextAlignment="Center"
                    VerticalTextAlignment="Center"
                    HorizontalOptions="Center"
                    VerticalOptions="Center"/>
            </Border>

         
            <Border
                     Grid.Row="2" Grid.Column="0"
                     Stroke="{StaticResource 4}"         
                     StrokeThickness="2"
                     StrokeShape="RoundRectangle 10"
                     Padding="10"
                     BackgroundColor="{StaticResource Gray}">
                    <Grid>
                    <Grid x:Name="GridTaraLabel">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="*"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>
                        
                        <Label  x:Name="TaraLabel"
                                     Text="{Binding Tara, StringFormat='{0} kg'}"
                                     FontSize="Title"
                                     Grid.Row="0"
                                     FontAttributes="Bold"
                                     TextColor="{StaticResource 4}"  
                                     HorizontalTextAlignment="Center"
                                     VerticalTextAlignment="Center"/>

                        <Label Grid.Row="1"
                                     Text="TARA"
                                     FontAutoScalingEnabled="True"
                                     TextColor="Black"
                                     HorizontalTextAlignment="Center"
                                     VerticalTextAlignment="Center" />

                    </Grid>
                    <Grid x:Name="GridSetTaraInicial" IsVisible="False">
                        <Button x:Name="BtnSetTaraInicial"
                                     Text="Capturar Tara"
                                     Clicked="BtnSetTaraInicial_Clicked"
                                     TextColor="Black"/>

                    </Grid>
                </Grid>
            </Border>



            <!-- DIFERENCIA -->
            <Frame  Grid.Row="2" Grid.Column="2"
                   BackgroundColor="{StaticResource 4}"
                   CornerRadius="10"
                   Padding="10"
                   HasShadow="True"
                   BorderColor="White"  
                    VerticalOptions="Center">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="2*"/>
                        <RowDefinition Height="1*"/>
                    </Grid.RowDefinitions>
                    <Label x:Name="DiferenciaLabel"
                       Text="{Binding Diferencia, StringFormat='{0} kg'}"
                       FontSize="Title"
                       TextColor="White"
                       HorizontalTextAlignment="Center"
                       VerticalTextAlignment="Center" 
                       Grid.Row="0"
                       FontAttributes="Bold"/>

                    <Label Grid.Row="1"
                        Text="DIFERENCIA"
                        TextColor="White"
                        HorizontalTextAlignment="Center"
                        VerticalTextAlignment="Center" />

                </Grid>

            </Frame>
        </Grid>

        <!-- Incia separador -->
        <BoxView
       Grid.Row="3"
       HeightRequest="2"
       HorizontalOptions="Fill"
       VerticalOptions="Start"
       Color="{StaticResource 4}" />
        
        <!-- Termina separador -->
        <Grid
            Margin="0,5,0,0"
           Grid.Row="4"
           ColumnDefinitions="*,*,*,*"
           HorizontalOptions="Fill"
           VerticalOptions="End">


            <Border
               x:Name="BtnBack"
               Grid.Column="0"
               BackgroundColor="{StaticResource 1}"
               HeightRequest="{OnPlatform Android=50,
                                          WinUI=80}"
               HorizontalOptions="Center"
               Stroke="{StaticResource 1}"
               StrokeShape="RoundRectangle 20"
               Style="{StaticResource RoundedBorderStyle}"
               WidthRequest="{OnPlatform Android=100,
                                         WinUI=250}">
                <Border.GestureRecognizers>
                    <TapGestureRecognizer Tapped="BtnBack_Clicked" />
                </Border.GestureRecognizers>

                <VerticalStackLayout
                   HorizontalOptions="Fill"
                   Spacing="5"
                   VerticalOptions="Center">

                    <Image
                       x:Name="BackIcon"
                       Aspect="AspectFit"
                       HeightRequest="{OnPlatform Android=25,
                                                  WinUI=50}"
                       HorizontalOptions="Fill"
                       Source="back2.png"
                       VerticalOptions="Fill"
                       WidthRequest="{OnPlatform Android=25,
                                                 WinUI=50}" />

                    <Label
                       x:Name="BackLabel"
                       Margin="{OnPlatform Android='0,-5,0,0'}"
                       FontAttributes="Bold"
                       FontSize="{OnPlatform Android=8,
                                             WinUI=16}"
                       Style="{StaticResource Label}"
                       Text="Volver"
                       TextColor="{StaticResource Black}" />

                </VerticalStackLayout>



                <VisualStateManager.VisualStateGroups>
                    <VisualStateGroupList>
                        <VisualStateGroup x:Name="CommonStates">

                            <VisualState x:Name="Normal" />

                            <VisualState x:Name="PointerOver">
                                <VisualState.Setters>
                                    <Setter TargetName="BackIcon" Property="Image.Source" Value="back.png" />
                                    <Setter TargetName="BackLabel" Property="Label.TextColor" Value="{StaticResource 1}" />
                                    <Setter Property="BackgroundColor" Value="{StaticResource 4}" />
                                    <Setter Property="Stroke" Value="{StaticResource 1}" />
                                </VisualState.Setters>
                            </VisualState>

                            <VisualState x:Name="Pressed">
                                <VisualState.Setters>
                                    <Setter Property="BackgroundColor" Value="{StaticResource 2}" />
                                    <Setter TargetName="BackLabel" Property="Label.TextColor" Value="{StaticResource 4}" />
                                </VisualState.Setters>
                            </VisualState>

                        </VisualStateGroup>
                    </VisualStateGroupList>
                </VisualStateManager.VisualStateGroups>
            </Border>

            <Border
               x:Name="BtnPickPartner"
               Grid.Column="1"
               BackgroundColor="{StaticResource 1}"
               HeightRequest="{OnPlatform Android=50,
                                          WinUI=80}"
               HorizontalOptions="Center"
               Stroke="{StaticResource 1}"
               StrokeShape="RoundRectangle 20"
               Style="{StaticResource RoundedBorderStyle}"
               WidthRequest="{OnPlatform Android=100,
                                         WinUI=250}">
                <Border.GestureRecognizers>
                    <TapGestureRecognizer Tapped="BtnPickPartner_Clicked" />
                </Border.GestureRecognizers>

                <VerticalStackLayout
                   HorizontalOptions="Fill"
                   Spacing="5"
                   VerticalOptions="Center">

                    <Image
                       x:Name="PartnerImage"
                       Aspect="AspectFit"
                       HeightRequest="{OnPlatform Android=30,
                                                  WinUI=50}"
                       HorizontalOptions="Fill"
                       Source="adduser.png"
                       VerticalOptions="Fill"
                       WidthRequest="{OnPlatform Android=30,
                                                 WinUI=50}" />

                    <Label
                       x:Name="PartnerLabel"
                       Margin="{OnPlatform Android='0,-10,0,0'}"
                       FontAttributes="Bold"
                       FontSize="{OnPlatform Android=8,
                                             WinUI=16}"
                       Style="{StaticResource Label}"
                       Text="Elegir Socio"
                       TextColor="{StaticResource Black}" />

                </VerticalStackLayout>


                <VisualStateManager.VisualStateGroups>
                    <VisualStateGroupList>
                        <VisualStateGroup x:Name="CommonStates">

                            <VisualState x:Name="Normal" />

                            <VisualState x:Name="PointerOver">
                                <VisualState.Setters>
                                    <Setter TargetName="PartnerImage" Property="Image.Source" Value="adduser.png" />
                                    <Setter TargetName="PartnerLabel" Property="Label.TextColor" Value="{StaticResource 1}" />
                                    <Setter Property="BackgroundColor" Value="{StaticResource 4}" />
                                    <Setter Property="Stroke" Value="{StaticResource 1}" />
                                </VisualState.Setters>
                            </VisualState>

                            <VisualState x:Name="Pressed">
                                <VisualState.Setters>
                                    <Setter Property="BackgroundColor" Value="{StaticResource 2}" />
                                    <Setter TargetName="PartnerLabel" Property="Label.TextColor" Value="{StaticResource 4}" />
                                </VisualState.Setters>
                            </VisualState>

                        </VisualStateGroup>
                    </VisualStateGroupList>
                </VisualStateManager.VisualStateGroups>
            </Border>

            <Border
               x:Name="BtnPickProduct"
               Grid.Column="2"
               BackgroundColor="{StaticResource 1}"
               HeightRequest="{OnPlatform Android=50,
                                          WinUI=80}"
               HorizontalOptions="Center"
               Stroke="{StaticResource 1}"
               StrokeShape="RoundRectangle 20"
               Style="{StaticResource RoundedBorderStyle}"
               WidthRequest="{OnPlatform Android=100,
                                         WinUI=250}">
                <Border.GestureRecognizers>
                    <TapGestureRecognizer Tapped="BtnPickProduct_Clicked" />
                </Border.GestureRecognizers>

                <VerticalStackLayout
                   HorizontalOptions="Fill"
                   Spacing="5"
                   VerticalOptions="Center">

                    <Image
                       x:Name="PickProductImage"
                       Aspect="AspectFit"
                       HeightRequest="{OnPlatform Android=30,
                                                  WinUI=50}"
                       HorizontalOptions="Fill"
                       Source="addweight.png"
                       VerticalOptions="Fill"
                       WidthRequest="{OnPlatform Android=30,
                                                 WinUI=50}" />

                    <Label
                       x:Name="PickProductLabel"
                       Margin="{OnPlatform Android='0,-10,0,0'}"
                       FontAttributes="Bold"
                       FontSize="{OnPlatform Android=8,
                                             WinUI=16}"
                       Style="{StaticResource Label}"
                       Text="Elegir Producto"
                       TextColor="{StaticResource Black}" />

                </VerticalStackLayout>


                <VisualStateManager.VisualStateGroups>
                    <VisualStateGroupList>
                        <VisualStateGroup x:Name="CommonStates">

                            <VisualState x:Name="Normal" />

                            <VisualState x:Name="PointerOver">
                                <VisualState.Setters>
                                    <Setter TargetName="PickProductImage" Property="Image.Source" Value="addweight2.png" />
                                    <Setter TargetName="PickProductLabel" Property="Label.TextColor" Value="{StaticResource 1}" />
                                    <Setter Property="BackgroundColor" Value="{StaticResource 4}" />
                                    <Setter Property="Stroke" Value="{StaticResource 1}" />
                                </VisualState.Setters>
                            </VisualState>

                            <VisualState x:Name="Pressed">
                                <VisualState.Setters>
                                    <Setter Property="BackgroundColor" Value="{StaticResource 2}" />
                                    <Setter TargetName="PickProductLabel" Property="Label.TextColor" Value="{StaticResource 4}" />
                                </VisualState.Setters>
                            </VisualState>

                        </VisualStateGroup>
                    </VisualStateGroupList>
                </VisualStateManager.VisualStateGroups>
            </Border>

            <Border
               x:Name="BtnCaptureNewWeight"
               Grid.Column="3"
               BackgroundColor="{StaticResource 1}"
               HeightRequest="{OnPlatform Android=50,
                                          WinUI=80}"
               HorizontalOptions="Center"
               Stroke="{StaticResource 1}"
               StrokeShape="RoundRectangle 20"
               Style="{StaticResource RoundedBorderStyle}"
               WidthRequest="{OnPlatform Android=100,
                                         WinUI=250}">
                <Border.GestureRecognizers>
                    <TapGestureRecognizer Tapped="BtnCaptureNewWeight_Clicked" />
                </Border.GestureRecognizers>

                <VerticalStackLayout
                   HorizontalOptions="Fill"
                   Spacing="5"
                   VerticalOptions="Center">

                    <Image
                       x:Name="CaptureWeightImage"
                       Aspect="AspectFit"
                       HeightRequest="{OnPlatform Android=30,
                                                  WinUI=50}"
                       HorizontalOptions="Fill"
                       Source="confirm.png"
                       VerticalOptions="Fill"
                       WidthRequest="{OnPlatform Android=30,
                                                 WinUI=50}" />

                    <Label
                       x:Name="CaptureWeightLabel"
                       Margin="{OnPlatform Android='0,-10,0,0'}"
                       FontAttributes="Bold"
                       FontSize="{OnPlatform Android=8,
                                             WinUI=16}"
                       Style="{StaticResource Label}"
                       Text="Confirmar Nueva Entrada"
                       TextColor="{StaticResource Black}" />

                </VerticalStackLayout>


                <VisualStateManager.VisualStateGroups>
                    <VisualStateGroupList>
                        <VisualStateGroup x:Name="CommonStates">

                            <VisualState x:Name="Normal" />

                            <VisualState x:Name="PointerOver">
                                <VisualState.Setters>
                                    <Setter TargetName="CaptureWeightImage" Property="Image.Source" Value="confirm.png" />
                                    <Setter TargetName="CaptureWeightLabel" Property="Label.TextColor" Value="{StaticResource 1}" />
                                    <Setter Property="BackgroundColor" Value="{StaticResource 4}" />
                                    <Setter Property="Stroke" Value="{StaticResource 1}" />
                                </VisualState.Setters>
                            </VisualState>

                            <VisualState x:Name="Pressed">
                                <VisualState.Setters>
                                    <Setter Property="BackgroundColor" Value="{StaticResource 2}" />
                                    <Setter TargetName="CaptureWeightLabel" Property="Label.TextColor" Value="{StaticResource 4}" />
                                </VisualState.Setters>
                            </VisualState>

                        </VisualStateGroup>
                    </VisualStateGroupList>
                </VisualStateManager.VisualStateGroups>
            </Border>


        </Grid>

        <!--<Grid 
          Grid.Row="3" 
          Grid.ColumnSpan="2"
          ColumnDefinitions="*,*,*,*" 
          Padding="10" 
          ColumnSpacing="15" 
          VerticalOptions="End" 
          HorizontalOptions="Fill">
            --><!-- Volver --><!--
            <Button 
                Grid.Column="0"
                x:Name="BtnBack"
                Text="Volver"
                Clicked="BtnBack_Clicked"
                BackgroundColor="Orange"
                TextColor="White"
                CornerRadius="8"
                Padding="12,6" />

            --><!-- Elegir Socio --><!--
            <Button  
                Grid.Column="1"
                x:Name="BtnPickPartner"
                Text="Elegir Socio"
                Clicked="BtnPickPartner_Clicked"
                BackgroundColor="#007BFF"
                TextColor="White"
                CornerRadius="8"
                Padding="12,6" 
                IsEnabled="False"
                />

            --><!-- Elegir Producto --><!--
            <Button 
                Grid.Column="2"
                x:Name="BtnPickProduct"
                Text="Elegir Producto"
                Clicked="BtnPickProduct_Clicked"
                IsVisible="False"
                BackgroundColor="#17A2B8"
                TextColor="White"
                CornerRadius="8"
                Padding="12,6" />   

            --><!-- Confirmar Nueva Entrada --><!--
            <Button 
                Grid.Column="3"
                x:Name="BtnCaptureNewWeight"
                Text="Confirmar Nueva Entrada"
                Clicked="BtnCaptureNewWeight_Clicked"
                BackgroundColor="#28A745"
                TextColor="White"
                CornerRadius="8"
                Padding="12,6" />
        </Grid>-->

    </Grid>
</ContentPage>